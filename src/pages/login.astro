---
/*
NOTE: The following code used to be included in a script tag on the page.
However, our english translations are now far more developed than any other language.
We are going to start a process of updating our translations, and can begin to opt-in
to different language automatic redirects once they hit a certain quality threshold.
Until then, we'll just only redirect to english for now, with the meta tag below

// WIP: trigger a client-side redirect based on the browser language.
// A vercel.json redirect is enforced in production, so no user should ever see this page.
// Remove the vercel.json redirect when this is ready.
const KNOWN_LANGUAGES = ['bg', 'de', 'en', 'es', 'fi', 'nl', 'pt-br', 'zh-cn', 'zh-tw', 'fr', 'kr', 'da', 'ja', 'pl', 'hu'];
let newLangWithRegion = (window.navigator.userLanguage || window.navigator.language || 'en-US').substr(0, 5);
let newLang = newLangWithRegion.substr(0, 2);
if (KNOWN_LANGUAGES.includes(newLangWithRegion)) {
	window.location.pathname = '/' + newLangWithRegion + '/getting-started';
} else if (KNOWN_LANGUAGES.includes(newLang)) {
	window.location.pathname = '/' + newLang + '/getting-started';
} else {
	window.location.pathname = '/en/getting-started';
}

*/


import SplashLayout from '../layouts/SplashLayout.astro';
import Logo from '~/components/SVGs/Logo.astro';
import NavBlock from '~/components/NavBlock.astro';
import IfLoggedIn from '~/components/DynamicContent/IfLoggedIn.astro';
import IfLoggedInDisabled from '~/components/DynamicContent/IfLoggedInDisabled.astro';
import UserInfo from '~/components/DynamicContent/UserInfo.astro';
import LoadingPlaceholder from '~/components/DynamicContent/LoadingPlaceholder.astro';
import SimpleButton from '~/components/Buttons/SimpleButton.astro';
import Button from '~/components/Button.astro';

import {initialize} from "@frontegg/js"

---

<!-- <meta http-equiv="refresh" content="0;url=/en/getting-started" /> -->
    

<SplashLayout title="Welcome">
	<script type="application/javascript" src="https://cdn.jsdelivr.net/npm/@frontegg/js/umd/frontegg.production.min.js"></script>
	<div class="content-wrapper">
		
		<div class="content">
			
			
			<div class="cell border">
				<h1>Welcome</h1>
				<p class="welcome-intro">
					Welcome to the future of resource management, where simplicity meets limitless potential. Being "in the field" has many challenges, getting access to the tools and information that you need doesn't have to be one of them. We know that having access to the right resources at the right time can make all the difference. That's where the E360 Field Force Navigator App comes in!
				</p>
				<!-- <p class="small">The below section reacts to whether or not you are logged in.</p> -->
			</div>
			
			<div id="app-root" class="cell flexCenter">
				
				<!-- <div>
				    <h1>This is Frontegg Integration in Vanilla Javascript </h1>
				    <div id="user-container"></div>
				    <br/>

				    <a id="logout" fe-state="isAuthenticated"><button>Logout</button></a>

				    <button id="loginWithRedirect" fe-mode="hosted"  fe-state="!isAuthenticated">
				        Login With Redirect
				    </button>

				</div> -->

				<p id="userNameVar">#userNameVar</p>
				<IfLoggedIn>					
					<div slot="loggedIn">
						<div>You are currently logged in.</div>
						<a href="/en/introduction">Enter Site</a>
						<a href="/user-data">User Data Page</a>
						<a id="logout">Log Out</a>
						
							
					</div>

					<div slot="loggedOut">
						<p>You are currently logged out.</p>
						<button 
							class='LogInOutButton' 
							id="loginWithRedirect"
							data-notification="false"
							data-event="GAEvent" 
							data-category="Header" 
							data-label="navLogIn" 
							data-action="Click" 
							data-value="undefined"
						>
							<div class="LogInOutButtonInner">
								<!-- <Icon name=ic:outline-notification-important /> -->
								<span>Log In</span>
							</div>
						</button>
					</div>
				  
				</IfLoggedIn>

			</div>
			<!-- end cell | cell layout -->
		</div>
	</div>
</SplashLayout>

<style lang="scss">
	article {
		width: 100%;
	}
	.content-wrapper {
		width: 100%;
		height: 100%;
		max-width: var(--page-width-1);
		display: flex;
		justify-content: flex-start;
		
		.content {
			position: relative;
			z-index: 1;
			padding-top: calc(var(--theme-navbar-height) + var(--doc-padding-block));
			padding-bottom: var(--doc-padding-block);
			padding-inline: var(--min-spacing-inline);
			width: 100%;
			height: 100%;
			margin-inline: auto;
			display: flex;
			flex-direction: row;
			/* overflow-x: hidden; */
			// max-width: 80vw;
			
			.cell{
				width: 50%;
				padding: 1rem;
				&.border{
					border-right: solid 1px var(--theme-text);
				}
				&.flexCenter{
					display: flex;
					justify-content: center;
					align-items: center;
					flex-direction: column;
				}
			}

			@media (max-width: 800px) {
				display: flex;
				flex-direction: column;

				.cell{
					width: 100%;
					padding: 1rem;
					&.border{
						border-right: none;
						border-bottom: solid 1px var(--theme-text);
					}
					
				}
			}

			.welcome-intro {
				margin-bottom: 1.5em;
				padding-right: 10%;
				@media (min-width: 50em) {
					padding-right: 20%;
				}	
			}

			.button-wrap{
				display: flex;
				flex-direction: column;
			}

		}
	}

</style>



<script>
	console.log("===== Frontegg Login  =====");
	import {initialize} from "@frontegg/js"

	const style = document.createElement('style');
	style.setAttribute('type', 'text/css');
	style.innerHTML = '';
	document.getElementsByTagName('head')[0].appendChild(style);


	const app = initialize({
	  contextOptions: {
	    baseUrl: "https://app-60w042yz5etg.frontegg.com", //set your Frontegg environment domain and client ID here
	    clientId: '22400201-214c-4be4-aa17-d66b72a2cce1'
	  },
	  hostedLoginBox: true
	})

	app.store.subscribe(() => {
	  const state = app.store.getState();
	  setTimeout(() => {
	    if (state.auth.user) {

	        //document.getElementById('user-container').innerText = state.auth.user.email;
	        console.log(state.auth.user);
	        SessionManager.setItem('loggedIn', 'true');
	        SessionManager.setItem('userDataEmail', state.auth.user.email);
	        SessionManager.setItem('userDataName', state.auth.user.name);
	        SessionManager.setItem('userDataGroups', state.auth.user.groups);
	        SessionManager.setItem('userDataRoles', state.auth.user.roles);


	      }else if(SessionManager.getItem('loggedIn') == 'true') {
	        
	        //document.getElementById('user-container').innerText =  SessionManager.getItem('userData-email');
	        console.log(state.auth.user);
	        console.log('========== logged in via cookie ==========');

	      } else {
	        
	        //not logged in

	      }
	  }, 0); //time in ms


/*===== ======= =====*/
/*===== ACTIONS =====*/
/*===== ======= =====*/
	  document.getElementById("loginWithRedirect").addEventListener('click', () => {
	    app.loginWithRedirect()
	  })

	  document.getElementById("logout").addEventListener('click', () => {
	  	console.log("logout button clicked");
	    SessionManager.setItem('loggedIn', 'false');
	    SessionManager.setItem('userDataEmail', 'X');
	    SessionManager.setItem('userDataName', 'X');
	    SessionManager.setItem('userDataGroups', 'X');
	    SessionManager.setItem('userDataRoles', 'X');
	    app.logout()
	    window.location.href = '/login'
	  })
	  

	  //document.getElementById('app-root').style.display = state.auth.isLoading ? 'hidden' : 'block'


	/*Basic Frontegg show/hide code*/
	  let styleHtml = ''
	  if (state.auth.isAuthenticated) {
	  	//USER IS LOGGED IN - via login function
	    //styleHtml += '[fe-state="isAuthenticated"] { }';
	    //styleHtml += '[fe-state="!isAuthenticated"] { display: none; }';
	    //Custom site actions
	    SessionManager.setItem('loggedIn', 'true');
	    SessionManager.setItem('userDataEmail', state.auth.user.email);
	    SessionManager.setItem('userDataName', state.auth.user.name);
	    SessionManager.setItem('userDataGroups', state.auth.user.groups);
	    SessionManager.setItem('userDataRoles', state.auth.user.roles);

	    window.location.replace('/en/introduction/');
	  } else if(SessionManager.getItem('loggedIn') == 'true'){
	  		//USER IS LOGGED IN - via cookie
	  	  //styleHtml += '[fe-state="isAuthenticated"] { }';
	  	  //styleHtml += '[fe-state="!isAuthenticated"] { display: none; }';
	  	  //Custom site actions
	  	  //SessionManager.setItem('loggedIn', 'true');
	  	  //window.location.replace('/en/introduction/');
	  } else  {
	  	//USER IS LOGGED OUT
	    //styleHtml += '[fe-state="isAuthenticated"] { display: none; }';
	    //styleHtml += '[fe-state="!isAuthenticated"] { }';
	    //Custom site actions
	    //SessionManager.setItem('loggedIn', 'false');
	  }

	  /*if(app.options.hostedLoginBox){
	    styleHtml += '[fe-mode="hosted"] { }';
	  } else {
	    styleHtml += '[fe-mode="hosted"] { display: none; }';
	  }*/

	  style.innerHTML = styleHtml;
	})



</script>

<script >
	console.log(SessionManager.getItem('loggedIn'));
	document.querySelector('#userNameVar').innerHTML  =  "LINE 299: "+SessionManager.getItem('userDataEmail');
	

	if(SessionManager.getItem('loggedIn').toString() == 'true') {
	  console.log("========== LOGIN DETECTED ==========");
	  console.log(state.auth.user);
	  SessionManager.setItem('userDataEmail', state.auth.user.email);
	  console.log("USERDATA VAR: " + SessionManager.getItem('userDataEmail'));
	  
	} else {
		
	}
</script>